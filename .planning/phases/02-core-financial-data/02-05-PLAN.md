---
phase: 02-core-financial-data
plan: 05
type: execute
wave: 4
depends_on: ["02-04"]
files_modified:
  - src/app/(app)/page.tsx
  - src/components/dashboard/month-selector.tsx
  - src/components/dashboard/balance-cards.tsx
  - src/components/dashboard/transaction-list.tsx
  - src/components/dashboard/quick-actions.tsx
autonomous: true

must_haves:
  truths:
    - "User sees monthly balance (income - expenses) for selected month"
    - "User sees total income and total expenses for selected month"
    - "User sees planned vs completed breakdown"
    - "User can navigate between months via month selector"
    - "User sees list of transactions for selected month"
    - "User can filter transactions by status (all/planned/completed)"
    - "User can filter transactions by type (all/income/expense)"
    - "User can search transactions by description"
    - "User can access quick actions for recurring and budget"
  artifacts:
    - path: "src/app/(app)/page.tsx"
      provides: "Dashboard page"
    - path: "src/components/dashboard/month-selector.tsx"
      provides: "Month navigation"
      exports: ["MonthSelector"]
    - path: "src/components/dashboard/balance-cards.tsx"
      provides: "Balance, income, expense cards"
      exports: ["BalanceCards"]
    - path: "src/components/dashboard/transaction-list.tsx"
      provides: "Filtered transaction list with search"
      exports: ["TransactionList"]
    - path: "src/components/dashboard/quick-actions.tsx"
      provides: "Quick action buttons"
      exports: ["QuickActions"]
  key_links:
    - from: "src/app/(app)/page.tsx"
      to: "src/hooks/use-month-selector.ts"
      via: "month state from URL"
      pattern: "useMonthSelector"
    - from: "src/components/dashboard/transaction-list.tsx"
      to: "src/lib/queries/transactions.ts"
      via: "useTransactions(month)"
      pattern: "useTransactions"
    - from: "src/components/dashboard/transaction-list.tsx"
      to: "src/components/transactions/transaction-item.tsx"
      via: "renders TransactionItem"
      pattern: "TransactionItem"
    - from: "src/components/dashboard/transaction-list.tsx"
      to: "src/components/transactions/transaction-form.tsx"
      via: "opens TransactionForm on edit/create"
      pattern: "TransactionForm"
---

<objective>
Build the dashboard page with month selector, balance cards, filtered transaction list with search, and quick actions. This is the main view users see after login.

Purpose: DASH-01 through DASH-08 + TRNS-07 (search) — the primary user-facing screen tying together all Phase 2 data.
Output: Fully functional dashboard at /app (the (app) route group root).
</objective>

<execution_context>
@/Users/charbellelopes/.claude/get-shit-done/workflows/execute-plan.md
@/Users/charbellelopes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/02-core-financial-data/02-01-SUMMARY.md
@.planning/phases/02-core-financial-data/02-04-SUMMARY.md
@src/hooks/use-month-selector.ts
@src/lib/queries/transactions.ts
@src/components/transactions/transaction-item.tsx
@src/components/transactions/transaction-form.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Dashboard components (month selector, balance cards, quick actions)</name>
  <files>
    src/components/dashboard/month-selector.tsx
    src/components/dashboard/balance-cards.tsx
    src/components/dashboard/quick-actions.tsx
  </files>
  <action>
1. **src/components/dashboard/month-selector.tsx** — 'use client'. Uses `useMonthSelector` hook (already created in 02-01). UI:
   - Horizontal layout: ← button | month label | → button
   - Left arrow: `ChevronLeft` icon, calls `prevMonth()`
   - Right arrow: `ChevronRight` icon, calls `nextMonth()`
   - Center: `monthLabel` displayed (e.g., "Fevereiro 2026"), font-heading, text-lg
   - Subtle tap/hover states on arrows
   Props: none (uses hook internally). Export `month` value for parent to pass to queries.
   Actually, better to accept `month`, `onPrev`, `onNext`, `label` as props so parent controls state.

2. **src/components/dashboard/balance-cards.tsx** — 'use client'. Takes `transactions` array (already decrypted). Calculates:
   - `totalIncome` = sum of amounts where type='income'
   - `totalExpense` = sum of amounts where type='expense'
   - `balance` = totalIncome - totalExpense
   - `plannedCount` = count where status='planned'
   - `completedCount` = count where status='completed'

   UI: Three cards in a grid (1 col mobile, 3 cols desktop):
   - **Saldo** (balance): Large number, green if positive, red if negative. Full-width or prominent.
   - **Receitas**: Green text, income total formatted. Small text showing completed/planned breakdown.
   - **Despesas**: Red text, expense total formatted. Small text showing completed/planned breakdown.

   Use `formatCurrency` for all values. Cards use shadcn Card component.
   Props: `transactions: DecryptedTransaction[]`.

3. **src/components/dashboard/quick-actions.tsx** — 'use client'. Row of action buttons:
   - "Nova transação" (Plus icon, primary bg) — main CTA, calls `onNewTransaction`
   - "Orçamento" (PiggyBank icon) — links to /app/orcamento
   - "Recorrentes" (Repeat icon) — links to /app/recorrentes (placeholder for Phase 3)
   Horizontal scroll on mobile, centered on desktop.
   Props: `onNewTransaction` callback.
  </action>
  <verify>`npx tsc --noEmit` passes. All 3 components exported.</verify>
  <done>Month selector with navigation, balance cards showing income/expense/balance with planned/completed breakdown, quick action buttons.</done>
</task>

<task type="auto">
  <name>Task 2: Transaction list with filters/search + dashboard page assembly</name>
  <files>
    src/components/dashboard/transaction-list.tsx
    src/app/(app)/page.tsx
  </files>
  <action>
1. **src/components/dashboard/transaction-list.tsx** — 'use client'. Accepts transactions array. Internal state for filters:
   - `statusFilter`: 'all' | 'planned' | 'completed' (default 'all')
   - `typeFilter`: 'all' | 'income' | 'expense' (default 'all')
   - `searchQuery`: string (default '')

   UI layout:
   - **Search bar**: Input with Search icon, placeholder "Buscar transações...", debounced (300ms) or instant filter. Uses `filterTransactionsBySearch` from queries/transactions.ts.
   - **Filter row**: Two sets of toggle buttons (shadcn Tabs or custom pill buttons):
     - Status: Todas | Planejadas | Realizadas
     - Type: Todas | Receitas | Despesas
   - **Transaction list**: Filtered transactions rendered as `TransactionItem` components. Grouped by date (optional — if simple, just a flat list sorted by due_date desc).
   - **Empty state**: When no transactions match filters, show "Nenhuma transação encontrada" with subtle illustration/icon.
   - **Loading state**: Skeleton cards (3-4 placeholder items).

   Filtering logic:
   ```
   let filtered = transactions
   if (statusFilter !== 'all') filtered = filtered.filter(t => t.status === statusFilter)
   if (typeFilter !== 'all') filtered = filtered.filter(t => t.type === typeFilter)
   if (searchQuery) filtered = filterTransactionsBySearch(filtered, searchQuery)
   ```

   On edit: opens TransactionForm in Sheet/Dialog (uses `useMediaQuery`). Passes selected transaction.
   On delete: TransactionForm has delete button, or add swipe/long-press later.

   Props: `transactions`, `isLoading`, `month` (for new transaction default date).

2. **src/app/(app)/page.tsx** — 'use client'. Replace placeholder content. Full dashboard:

   Uses `useMonthSelector()` hook for month state.
   Uses `useTransactions(month)` for data.

   Layout (top to bottom):
   - **Header**: "Olá, {username}!" greeting (get from profile or user email). Small text "Seu resumo financeiro".
   - **MonthSelector**: Full-width month navigation.
   - **BalanceCards**: Three cards with calculated totals from transactions.
   - **QuickActions**: Action buttons row. "Nova transação" opens TransactionForm.
   - **TransactionList**: List with filters and search.

   TransactionForm opens in Sheet (mobile) / Dialog (desktop) via `useMediaQuery`. Controlled by `useState` for open state and optional edit target.

   Loading state: Show skeleton for balance cards + transaction list while `useTransactions` is loading.

   Error state: If query errors, show toast or inline error message.
  </action>
  <verify>`npx tsc --noEmit` passes. Navigate to /app — dashboard renders with month selector, balance cards, quick actions, transaction list. Creating transaction via form updates list. Filters work. Search works.</verify>
  <done>Complete dashboard: month navigation, balance cards (income/expense/balance with planned/completed), quick actions, transaction list with status/type filters and description search. Transaction CRUD accessible from dashboard via form Sheet/Dialog.</done>
</task>

</tasks>

<verification>
- /app loads with dashboard (not placeholder)
- Month selector navigates between months, URL updates
- Balance cards show correct income, expenses, balance for month
- "Nova transação" opens form, creating transaction updates list + balance
- Status filter: "Planejadas" shows only planned, "Realizadas" only completed
- Type filter: "Receitas" shows only income, "Despesas" only expense
- Search: typing "aluguel" filters transactions by description
- Toggling transaction status updates instantly (optimistic)
- Edit transaction: tap item → form pre-fills → save updates
- Empty month shows "Nenhuma transação encontrada"
</verification>

<success_criteria>
DASH-01 through DASH-08 + TRNS-07 all working. Dashboard is the primary screen. All Phase 2 success criteria from roadmap verifiable from this page.
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-financial-data/02-05-SUMMARY.md`
</output>
