---
phase: 04-integrations-and-activation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/app/perfil/page.tsx
  - src/components/profile/profile-form.tsx
  - src/components/profile/logout-button.tsx
  - src/components/profile/settings-section.tsx
  - src/lib/queries/profile.ts
  - src/components/ui/fab.tsx
  - src/app/app/layout.tsx
autonomous: true

must_haves:
  truths:
    - "User can view profile page with name and email"
    - "User can edit full_name on profile"
    - "User can log out from profile page"
    - "User sees settings sections linking to subscription and WhatsApp settings"
    - "FAB appears on mobile for quick transaction creation"
  artifacts:
    - path: "src/app/app/perfil/page.tsx"
      provides: "Profile page with settings hub"
    - path: "src/components/profile/profile-form.tsx"
      provides: "Edit full_name form"
    - path: "src/components/profile/logout-button.tsx"
      provides: "Sign out button"
    - path: "src/components/ui/fab.tsx"
      provides: "Floating action button"
  key_links:
    - from: "src/components/profile/logout-button.tsx"
      to: "supabase.auth.signOut"
      via: "client-side auth call"
      pattern: "signOut"
    - from: "src/components/ui/fab.tsx"
      to: "src/app/app/layout.tsx"
      via: "included in app layout"
      pattern: "FAB"
---

<objective>
Profile page with settings hub, logout, name editing. Plus FAB component integrated into app layout for quick mobile transaction creation.

Purpose: Users need profile management, settings navigation, and quick transaction access.
Output: Profile page, profile form, logout, settings sections, FAB component.
</objective>

<execution_context>
@/Users/charbellelopes/.claude/get-shit-done/workflows/execute-plan.md
@/Users/charbellelopes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/app/app/layout.tsx
@src/components/navigation/nav-items.ts
@.planning/phases/04-integrations-and-activation/04-RESEARCH.md (Pattern 6: FAB)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Profile page with form, logout, and settings links</name>
  <files>
    src/app/app/perfil/page.tsx
    src/components/profile/profile-form.tsx
    src/components/profile/logout-button.tsx
    src/components/profile/settings-section.tsx
    src/lib/queries/profile.ts
  </files>
  <action>
    **src/lib/queries/profile.ts**: TanStack Query hooks.
    - `useProfile()`: fetch profiles table for current user. Return full_name, avatar_url, onboarding_completed, onboarding_step. staleTime: 5min.
    - `useUpdateProfile()`: mutation to update profiles table (full_name). Invalidate ['profile'] on success.

    **src/components/profile/profile-form.tsx**: Edit name form.
    - React Hook Form + Zod: `{ full_name: z.string().min(2, 'Nome muito curto') }`
    - Input for full_name, pre-populated from useProfile
    - Email displayed as read-only (from supabase.auth.getUser)
    - Save button with loading state
    - Toast on success: "Perfil atualizado"
    - Use Shadcn Input, Button, Label, Form components

    **src/components/profile/logout-button.tsx**: Sign out.
    - Red-tinted destructive variant button "Sair da conta"
    - LogOut icon from lucide-react
    - AlertDialog confirmation: "Tem certeza que deseja sair?"
    - On confirm: `supabase.auth.signOut()` then `router.push('/')`

    **src/components/profile/settings-section.tsx**: Settings hub links.
    - Card-style sections with ChevronRight icon
    - Links:
      - "Assinatura" → /app/configuracoes/assinatura (CreditCard icon)
      - "WhatsApp" → /app/configuracoes/whatsapp (MessageCircle icon)
      - "Política de Privacidade" → /privacidade (Shield icon)
    - Each as a clickable card row with icon + label + chevron

    **src/app/app/perfil/page.tsx**: Page composition.
    - Title "Perfil" at top
    - ProfileForm component
    - Separator
    - SettingsSection component
    - Separator
    - LogoutButton at bottom
    - All wrapped in max-w-lg centered layout

    All text pt-BR. Use existing Shadcn components (Card, Button, Input, Separator, AlertDialog).
    Need to install AlertDialog if not already: `npx shadcn@latest add alert-dialog` (check first if exists).
  </action>
  <verify>
    `npx tsc --noEmit` passes. Profile page exists at src/app/app/perfil/page.tsx. Settings links point to correct routes.
  </verify>
  <done>
    Profile page shows user name (editable), email (read-only), settings navigation, and logout button with confirmation dialog.
  </done>
</task>

<task type="auto">
  <name>Task 2: FAB component + integrate into app layout</name>
  <files>
    src/components/ui/fab.tsx
    src/app/app/layout.tsx
  </files>
  <action>
    **src/components/ui/fab.tsx**: Floating action button.
    - Fixed position: bottom-20 right-4 (above bottom nav on mobile), md:bottom-6 md:right-6 (desktop)
    - 56px (w-14 h-14), rounded-full, shadow-lg
    - Plus icon from lucide-react (h-6 w-6)
    - bg-primary text-primary-foreground
    - Scroll behavior: hide on scroll down (scrollY > lastScrollY && scrollY > 100), show on scroll up
    - Transition: translate-y-0 opacity-100 ↔ translate-y-20 opacity-0 (duration-200)
    - z-50
    - aria-label="Adicionar transação"
    - Props: `onClick: () => void`

    **src/app/app/layout.tsx**: Integrate FAB.
    - IMPORTANT: Layout is currently a server component. Need to extract FAB + sheet into a client wrapper.
    - Create inline client component `AppShell` or separate file `src/components/app-shell.tsx`:
      - State for transaction sheet open/close
      - FAB onClick opens transaction sheet
      - Import existing TransactionForm (check if transaction-form exists as sheet-compatible)
      - If TransactionForm is not sheet-compatible, wrap in Sheet component
    - FAB visible only on mobile: wrap in `<div className="md:hidden">`
    - Keep layout as server component, move client interactivity to child component
    - The FAB should be placed INSIDE the existing layout structure but outside <main>
    - Check if there's an existing Sheet-based transaction form from Phase 2 — if so, reuse it

    IMPORTANT: Do NOT convert the server layout to client component. Use composition pattern:
    ```
    // layout.tsx (server)
    <QueryProvider>
      <div className="flex min-h-screen">
        <Sidebar />
        <main>...</main>
        <BottomNav />
        <FABWrapper />  {/* client component */}
      </div>
    </QueryProvider>
    ```
  </action>
  <verify>
    `npx tsc --noEmit` passes. FAB renders on mobile viewport. Layout still works as server component. FAB click opens transaction form.
  </verify>
  <done>
    FAB button appears bottom-right on mobile, hides on scroll down, opens transaction form sheet on click. Desktop hides FAB or shows in corner.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- Profile page renders at /app/perfil
- Name edit saves to profiles table
- Logout signs out and redirects to /
- Settings links navigate to correct routes
- FAB visible on mobile, opens transaction sheet
</verification>

<success_criteria>
- Profile page complete with form, settings, logout
- FAB integrated into app layout without breaking server component
- All settings sections link to correct destinations
</success_criteria>

<output>
After completion, create `.planning/phases/04-integrations-and-activation/04-02-SUMMARY.md`
</output>
